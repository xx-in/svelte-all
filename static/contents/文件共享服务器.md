# 创建文件共享服务器

该文件共享服务器是用于在局域网内共享文件，只要记住ip地址，就可以在局域网内共享服务。

```js
const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs');

const app = express();
const PORT = 3000;

// 设置上传目录
const UPLOAD_DIR = path.join(__dirname, 'uploads');
if (!fs.existsSync(UPLOAD_DIR)) {
	fs.mkdirSync(UPLOAD_DIR);
}

// 配置 Multer
const storage = multer.diskStorage({
	destination: (req, file, cb) => {
		cb(null, UPLOAD_DIR);
	},
	filename: (req, file, cb) => {
		cb(null, file.originalname); // 保留原文件名
	}
});
const upload = multer({ storage });

// 中间件：用于处理表单和静态文件
app.use(express.static('public'));

// 上传页面（GET）
app.get('/', (req, res) => {
	res.send(`
    <h2>上传文件</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
      <input type="file" name="myfile" />
      <button type="submit">上传</button>
    </form>
    <h2>已上传文件</h2>
    <ul>
      ${fs
				.readdirSync(UPLOAD_DIR)
				.map((f) => `<li><a href="/download/${encodeURIComponent(f)}">${f}</a></li>`)
				.join('')}
    </ul>
  `);
});

// 上传文件处理（POST）
app.post('/upload', upload.single('myfile'), (req, res) => {
	res.redirect('/');
});

// 下载文件接口
app.get('/download/:filename', (req, res) => {
	const filename = req.params.filename;
	const filepath = path.join(UPLOAD_DIR, filename);
	if (fs.existsSync(filepath)) {
		res.download(filepath);
	} else {
		res.status(404).send('文件不存在');
	}
});

// 启动服务
app.listen(PORT, () => {
	console.log(`文件上传服务运行中：http://localhost:${PORT}`);
});
```
