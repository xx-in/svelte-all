# 罚函数法

罚函数法（Penalty Method）是求解约束优化问题的一类数值方法，  
通过将约束“吸收”到目标函数中，将约束优化问题转化为一系列无约束优化问题。

## 一、原理

给定约束优化问题：

$$
\min f(x), \quad
\text{s.t. } g_i(x) \le 0, \ i=1,\dots,m, \quad
h_j(x) = 0, \ j=1,\dots,p
$$

罚函数法构造**罚函数** $P(x, r)$，将违反约束的代价加到目标中：

$$
F(x, r) = f(x) + P(x, r)
$$

其中 $r > 0$ 为**罚因子**，控制约束违背的惩罚强度。

## 二、常用罚函数类型

1. **外罚函数（Exterior Penalty）**
   - 对违反约束的点施加惩罚，函数在可行域外定义：
     $$
     P(x, r) = r \left( \sum_{i=1}^m \max\{0, g_i(x)\}^2 + \sum_{j=1}^p h_j(x)^2 \right)
     $$

2. **内罚函数（Interior/Barrier Penalty）**
   - 在可行域内部定义，靠近约束边界罚值趋于无穷：
     $$
     P(x, r) = -\frac{1}{r} \sum_{i=1}^m \ln(-g_i(x))
     $$

- 外罚函数适合逐步逼近可行解；
- 内罚函数用于保持迭代点严格在可行域内。

## 三、算法步骤（外罚函数法示例）

1. 选取初始罚因子 $r_0 > 0$ 和初始点 $x_0$。
2. 构造无约束函数：

   $$
   F(x, r_k) = f(x) + r_k \sum_{i=1}^m \max\{0, g_i(x)\}^2 + r_k \sum_{j=1}^p h_j(x)^2
   $$

3. 求解无约束优化：

   $$
   x_{k+1} = \arg\min F(x, r_k)
   $$

4. 增加罚因子 $r_{k+1} > r_k$，使约束惩罚更大。
5. 重复步骤 2–4，直到约束满足精度 $\epsilon$。

## 四、收敛性说明

- 对凸问题，外罚函数法可保证 $x_k \to x^*$，逼近原问题可行最优解；
- 对非凸问题，需要选择足够大的罚因子 $r_k$，同时注意避免数值病态（罚因子过大导致优化困难）。

## 五、优缺点

**优点**：

- 简化约束问题为无约束问题；
- 易于与梯度法、牛顿法等结合。

**缺点**：

- 大罚因子可能导致函数条件数变差；
- 内外罚函数选择和参数调整需要经验。

## 六、直观理解

- 外罚函数：约束被“罚”出来，迭代逐步靠近可行域边界；
- 内罚函数：约束被“障碍”挡住，迭代始终在可行域内部；
- 罚函数法通过不断调整罚因子，使无约束最小点趋向原约束最优点。
