# 共轭梯度法示例（二维）

求解函数最小值：

$$
f(x_1,x_2) = x_1^2 + 2 x_2^2 + 2
$$

初始点：

$$
x_0 = \begin{pmatrix}1 \\ 1\end{pmatrix}.
$$

---

## 1. 确定矩阵 $Q$

二次函数可以写作：

$$
f(x) = x^T Q x + \text{(线性项)} + \text{常数}.
$$

对比形式：

$$
x^T Q x =
\begin{pmatrix}x_1 & x_2\end{pmatrix}
\begin{pmatrix}q_{11} & q_{12} \\ q_{21} & q_{22} \end{pmatrix}
\begin{pmatrix}x_1 \\ x_2\end{pmatrix} = q_{11} x_1^2 + (q_{12}+q_{21}) x_1 x_2 + q_{22} x_2^2
$$

得到：

$$
Q = \begin{pmatrix}1 & 0 \\ 0 & 2\end{pmatrix}.
$$

> **说明**：
>
> - $q_{11},q_{22}$：对应变量平方项系数
> - $q_{12}=q_{21}$：变量间耦合（这里为0）

---

## 2. 标准形式

共轭梯度法要求：

$$
\phi(x) = \frac{1}{2} x^T A x - b^T x + c
$$

取：

$$
A = 2 Q = \begin{pmatrix}2 & 0 \\ 0 & 4\end{pmatrix}, \quad
b = \begin{pmatrix}0 \\ 0\end{pmatrix}, \quad
c = 2
$$

梯度：

$$
g_k = \nabla f(x_k) = A x_k - b = \begin{pmatrix}2 & 0 \\ 0 & 4\end{pmatrix} x_k
$$

> **说明**：
>
> - $g_k$：在 $x_k$ 点的梯度，表示函数上升最快方向
> - 共轭方向用 $d_k$ 表示

---

## 3. 共轭梯度法迭代公式（用梯度表示）

初始化：

$$
g_0 = \nabla f(x_0), \quad d_0 = -g_0
$$

迭代公式：

$$
x_{k+1} = x_k + \lambda_k d_k
$$

$$
g_{k+1} = \nabla f(x_{k+1}), \quad
$$

$$

\beta_k = \frac{g_{k+1}^T g_{k+1}}{g_k^T g_k} = \frac{\|g_{k+1}\|^2}{\|g_k^T\|^2}, \quad
$$

$$

d_{k+1} = -g_{k+1} + \beta_k d_k
$$

$$
\lambda_k = \frac{g_k^T g_k}{d_k^T A d_k}, \quad
$$

停止条件：

$$

\|g_k\| \approx 0


$$

> **说明**：
>
> - $g_k$：梯度
> - $d_k$：共轭方向
> - $\lambda_k$：步长
> - $\beta_k$：调整共轭方向系数

---

## 4. 第 0 步

梯度：

$$

g_0 = \nabla f(x_0) = \begin{pmatrix}2 & 0 \\ 0 & 4\end{pmatrix} \begin{pmatrix}1 \\ 1\end{pmatrix}
= \begin{pmatrix}2 \\ 4\end{pmatrix}


$$

初始共轭方向：

$$

d_0 = -g_0 = \begin{pmatrix}-2 \\ -4\end{pmatrix}


$$

步长：

$$

\lambda_0 = \frac{g_0^T g_0}{d_0^T A d_0} = \frac{20}{72} = \frac{5}{18}


$$

更新点：

$$

x_1 = x_0 + \lambda_0 d_0 = \begin{pmatrix}1 \\ 1\end{pmatrix} + \frac{5}{18} \begin{pmatrix}-2 \\
-4\end{pmatrix} = \begin{pmatrix}4/9 \\ -1/9\end{pmatrix}


$$

更新梯度：

$$

g_1 = \nabla f(x_1) = \begin{pmatrix}2 & 0 \\ 0 & 4\end{pmatrix} \begin{pmatrix}4/9 \\
-1/9\end{pmatrix} = \begin{pmatrix}8/9 \\ -4/9\end{pmatrix}


$$

共轭系数：

$$

\beta_0 = \frac{g_1^T g_1}{g_0^T g_0} = \frac{80/81}{20} = \frac{4}{81}


$$

更新共轭方向：

$$

d_1 = -g_1 + \beta_0 d_0 = \begin{pmatrix}-80/81 \\ 20/81\end{pmatrix}


$$

---

## 5. 第 1 步

步长：

$$

\lambda_1 = \frac{g_1^T g_1}{d_1^T A d_1} = \frac{6480/6561}{14400/6561} = \frac{9}{20}


$$

更新点：

$$

x_2 = x_1 + \lambda_1 d_1 = \begin{pmatrix}0 \\ 0\end{pmatrix}


$$

更新梯度：

$$

g_2 = \nabla f(x_2) = \begin{pmatrix}0 \\ 0\end{pmatrix}


$$

迭代结束。

---

## 6. 结果

- **最优点**：

$$

x^\* = \begin{pmatrix}0 \\ 0\end{pmatrix}


$$

- **最小值**：

$$

f(x^\*) = 2


$$

- **特点**：二维二次函数，共轭梯度法两步即可精确收敛。$$
