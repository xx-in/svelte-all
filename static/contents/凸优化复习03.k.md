# 单纯形法（Simplex Method）

单纯形法是一种用于求解 **线性规划问题（Linear Programming, LP）**
的经典算法。线性规划是凸规划的一种。

---

## 一、 标准形式

线性规划的标准形式为：

$$
\begin{aligned}
\min \quad & f(x) = c^T x \\
\text{s.t.} \quad & A x = b, \\
& x \ge 0
\end{aligned}
$$

其中：

- $f(x)$ 为目标函数
- $x \in \mathbb{R}^n$ 为决策变量，但是要求$x$非负时才有意义；
- $A \in \mathbb{R}^{m \times n}$；
- $b \in \mathbb{R}^m$。
- $c \in \mathbb{R}^n$。

> 注意：对于第三条，在单纯形法中要求$b \in \mathbb{R}_+^m$，否则第一个基本解不是基本可行解，无法使用一般单纯形法。此时需要使用大M法或者两阶段法等改进版的单纯形法。

---

## 二、转化为标准型

对于一般的线性规划问题，通常不是标准型，我们需要将原问题转化为标准形式：

1. 最大化问题可以通过负号转换为最小化问题

   $$
   \max \; c^T x \quad
   \Rightarrow \quad \min \;
   \big(-c^T x\big)
   $$

2. 决策变量$x_i$无约束，即无非负约束时，可拆分为两个新的决策变量

   $$
   x_i \in \mathbb{R} \quad \Rightarrow \quad  x_i = x_{i1} - x_{i2}, \quad x_{i1} \ge 0 ,\quad x_{i2} \ge 0
   $$

3. 不等式约束转换为等式约束，额外增加新的松弛变量（决策变量）转换为等式

$$
a^Tx_i \le b \quad\Rightarrow\quad a^Tx_i + s_i = b , s_i \ge 0
$$

$$
a^Tx_j \ge b \quad\Rightarrow\quad a^Tx_j - s_j = b , s_j \ge 0
$$

4. 决策变量存在上下界$a \le x_i \le b$，即不符合$x_i \ge 0$，

   $$
   a \le x_i \le b \quad  \\
   \Rightarrow a-a \le x_i-a \\
   \Rightarrow x_{i1} = x_i - a \ge 0\\
   x_{i1} + a \le b \text{}
   $$

   转化为一个新的决策变量和一个约束条件。

5. 目标函数或者约束函数中存在绝对值$|x_i|$

$$
x_{i1} =  \frac{|x|  + x}{2} \\
x_{i2} =  \frac{|x|  - x}{2} \\

\Rightarrow |x_i| = x_{i1} - x_{i2}
$$

将包含绝对值形式的决策变量转换为两个新的决策变量。

> 注：当修改决策变量的数量时，需要同步替换目标函数中的决策变量。

---

## 三、基本变量与非基本变量

将约束 $A x = b$ 中的变量分为：

- **基本变量（basic variables）**：对应 $A$ 的一个可逆子矩阵 $B$；
- **非基本变量（nonbasic variables）**：其余变量 $N$。

根据分块矩阵设：

$$
x = \begin{bmatrix} x_B \\ x_N \end{bmatrix}, \quad A = [B \; N]
$$

则根据分块矩阵计算公式有：

$$
B x_B + N x_N = b \quad
$$

因为$B$是可逆矩阵，左乘$B^{-1}$并移项有：

$$
\quad x_B = B^{-1} b - B^{-1} N x_N
$$

当 $x_N = 0$ 时，可得一个 **基本可行解（BFS）**：

$$
x_B = B^{-1} b, \quad x_N = 0
$$

---

## 四、检验最优性

目标函数为：

$$
f(x) = c_B^T x_B + c_N^T x_N
$$

代入 $x_B = B^{-1} b - B^{-1} N x_N$ 得：

$$
f(x) = c_B^T B^{-1} b + (c_N^T - c_B^T B^{-1} N)x_N
$$

此时目标函数仅与非基变量$x_N$相关，若系数$c_N^T - c_B^T B^{-1} N$均为非负数，则表示将任意项$x_j \in x_N$从$0$调整为正数，都会使得目标函数变大。

故若定义 **检验数（reduced cost）**：

$$
r_N = c_N^T - c_B^T B^{-1} N
$$

- 若存在 $r_j < 0$，则：在**最小化问题**中，增加 $ x_j $ 可以降低目标函数值， 有改进空间，$x_j$
  是潜在的 **入基变量**。

$$
r_j < 0 \quad \Rightarrow \quad x_j \text{ 有望进基}
$$

- 若 $r_j > 0$，则：增加 $x_j$会使目标函数变大，不应进入基，当前基仍可能最优。

  $$
  r_j > 0 \quad \Rightarrow \quad x_j \text{ 不宜入基}
  $$

- 若所有 $r_j \ge 0$，则：当前解已经达到最优（最小化问题）。

  $$
  r_j \ge 0, \ \forall j \notin B
  \quad \Rightarrow \quad
  x_B = A_B^{-1} b \text{ 为最优解}
  $$

---

## 五、换基操作（Pivot）

当某个非基变量 $ x_j $ 的检验数 $ r_j < 0 $ 时，  
说明目标函数还有改进空间，需要让该变量进入基中。

为保持可行性，必须使得更新后的基本变量仍满足 $ x_B \ge 0 $。  
由

$$
x_B = B^{-1}b - B^{-1}N x_N
$$

若令 $ x_j $ 增加（其余 $ x_N = 0 $），则基本变量变化为：

$$
x_B' = B^{-1}b - d_j x_j, \quad \text{其中 } d_j = B^{-1}A_j
$$

为使得 $ x_B' \ge 0 $，需保证：

$$
x_j \le \min_{i}\left\{ \frac{(B^{-1}b)_i}{(B^{-1}A_j)_i} \,\middle|\, (B^{-1}A_j)_i > 0 \right\}
$$

该最小比值对应的基变量将离开基（称为**出基变量**），对应的行称为 **主元行（pivot row）**。  
变量 $ x_j $ 对应的列称为 **主元列（pivot column）**。

> 换基操作（pivot）本质上是通过行列运算更新矩阵 $ B^{-1} $ 与对应的 $ c_B $，得到新的基本可行解。

---

## 六、简易单纯形表

通过例子绘制单纯形表，对于问题：

$$
min \quad -x_2 + 2x_3 \\
s.t. \quad x_1 - 2x_2 + x_3 = 2\\
x_2 - 3x_3 \le 1 \\
x_2 - x_3 \le 2 \\
x_1,x_2,x_3 \ge 0
$$

1. 引入松弛变量转化为标准型

$$
min \quad -x_2 + 2x_3 \\
s.t. \quad x_1 - 2x_2 + x_3 = 2\\
x_2 - 3x_3  + x_4 = 1 \\
x_2 - x_3  + x_5 = 2 \\
x_1,x_2,x_3,x_4,x_5 \ge 0
$$

2. 其中各变量有以下等式

$$
A = \begin{bmatrix}
1 & -2 & 1  & 0 & 0  \\
0 & 1 & -3 & 1 & 0 \\
0 & 1 & -1 & 0 & 1 \\
\end{bmatrix}
$$

$$
b = \begin{bmatrix}
2 & 1 &2
\end{bmatrix}^T
$$

$$

c = \begin{bmatrix}
0 & -1 &2 & 0 &0
\end{bmatrix}^T
$$

3. 选取第一个基本变量矩阵，通常会存在一个单位矩阵，选取$x_1,x_4,x_5$为基变量，构造第一个单纯形表：

|  c  |        |  $0$  | $-1$  |  $2$  |  $0$  |  $0$  |            |
| :-: | :----: | :---: | :---: | :---: | :---: | :---: | :--------: |
|     | 基变量 | $x_1$ | $x_2$ | $x_3$ | $x_4$ | $x_5$ | 右端项 $b$ |
| $0$ | $x_1$  |  $1$  | $-2$  |  $1$  |  $0$  |  $0$  |    $2$     |
| $0$ | $x_4$  |  $0$  |  $1$  | $-3$  |  $1$  |  $0$  |    $1$     |
| $0$ | $x_5$  |  $0$  |  $1$  | $-1$  |  $0$  |  $1$  |    $2$     |
|     |  $r$   |  $0$  |  $?$  |  $?$  |  $0$  |  $0$  |            |

对于基变量，检验数都为$0$，对于非基变量需要计算校验数：其中 $A_j$ 表示 $x_j$ 对应的列向量

$$
B = \begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

$$
A_2 = \begin{bmatrix}
-2 \\
1 \\
1
\end{bmatrix}
$$

$$
A_3 = \begin{bmatrix}
1 \\
-3 \\
1
\end{bmatrix}
$$

$$
r_j = c_j - c_B^T B^{-1} A_j
$$

$$
r_2 = -1 - [0,0,0]^T
\begin{bmatrix}1 & 0 & 0\\ 0 & 1 & 0 \\ 0 & 0& 1\end{bmatrix}
\begin{bmatrix}-2 \\ 1 \\ 1\end{bmatrix}
= -1
$$

$$
r_3 = 2 - [0,0,0]^T
\begin{bmatrix}1 & 0 & 0\\ 0 & 1 & 0 \\ 0 & 0& 1\end{bmatrix}
\begin{bmatrix}1 \\ -3 \\ 1\end{bmatrix}
= 2
$$

更新单纯形表有：

|  c  |        |  $0$  | $-1$  |  $2$  |  $0$  |  $0$  |            |
| :-: | :----: | :---: | :---: | :---: | :---: | :---: | :--------: |
|     | 基变量 | $x_1$ | $x_2$ | $x_3$ | $x_4$ | $x_5$ | 右端项 $b$ |
| $0$ | $x_1$  |  $1$  | $-2$  |  $1$  |  $0$  |  $0$  |    $2$     |
| $0$ | $x_4$  |  $0$  |  $1$  | $-3$  |  $1$  |  $0$  |    $1$     |
| $0$ | $x_5$  |  $0$  |  $1$  | $-1$  |  $0$  |  $1$  |    $2$     |
|     |  $r$   |  $0$  | $-1$  |  $2$  |  $0$  |  $0$  |            |

4. 判断是否是最优解

因为$r_2 = -1 < 0$，不满足最优解，此时$x_2$为进基变量，计算离基变量

$$
\theta = \frac{b}{A_j} = \frac{\begin{bmatrix}2&1&2\end{bmatrix}}{\begin{bmatrix}-2&1&2\end{bmatrix}} =
\begin{bmatrix}-1&1&2\end{bmatrix}
$$

其中$\theta_2 = 1$为最小正数，故$x_4$为离基变量，更新单纯形表有

|  c  |        |  $0$  |    $-1$     |  $2$  |  $0$  |  $0$  |            |
| :-: | :----: | :---: | :---------: | :---: | :---: | :---: | :--------: |
|     | 基变量 | $x_1$ |    $x_2$    | $x_3$ | $x_4$ | $x_5$ | 右端项 $b$ |
| $0$ | $x_1$  |  $1$  |    $-2$     |  $1$  |  $0$  |  $0$  |    $2$     |
| $0$ | $x_4$  |  $0$  | $\boxed{1}$ | $-3$  |  $1$  |  $0$  |    $1$     |
| $0$ | $x_5$  |  $0$  |     $1$     | $-1$  |  $0$  |  $1$  |    $2$     |
|     |  $r$   |  $0$  |    $-1$     |  $2$  |  $0$  |  $0$  |            |

因为$x_4$为离基变量，$x_2$为进基变量，所以需要将$A_2$中当前行通过行倍乘处理为$1$,其他行通过矩阵行倍加变换，将其他行该列的值置为$0$，使得新$B$矩阵为单位矩阵。

|  c   |        |  $0$  | $-1$  |  $2$  |  $0$  |  $0$  |            |
| :--: | :----: | :---: | :---: | :---: | :---: | :---: | :--------: |
|      | 基变量 | $x_1$ | $x_2$ | $x_3$ | $x_4$ | $x_5$ | 右端项 $b$ |
| $0$  | $x_1$  |  $1$  |  $0$  | $-5$  |  $2$  |  $0$  |    $4$     |
| $-1$ | $x_2$  |  $0$  |  $1$  | $-3$  |  $1$  |  $0$  |    $1$     |
| $0$  | $x_5$  |  $0$  |  $0$  |  $2$  | $-1$  |  $1$  |    $1$     |
|      |  $r$   |  $0$  |  $0$  |  $?$  |  $?$  |  $0$  |            |

计算新的校验数

|  c   |        |  $0$  | $-1$  |     $2$     |  $0$  |  $0$  |            |
| :--: | :----: | :---: | :---: | :---------: | :---: | :---: | :--------: |
|      | 基变量 | $x_1$ | $x_2$ |    $x_3$    | $x_4$ | $x_5$ | 右端项 $b$ |
| $0$  | $x_1$  |  $1$  |  $0$  |    $-5$     |  $2$  |  $0$  |    $4$     |
| $-1$ | $x_2$  |  $0$  |  $1$  |    $-3$     |  $1$  |  $0$  |    $1$     |
| $0$  | $x_5$  |  $0$  |  $0$  | $\boxed{2}$ | $-1$  |  $1$  |    $1$     |
|      |  $r$   |  $0$  |  $0$  |    $-1$     |  $1$  |  $0$  |            |

由于 $r_3 = -1 <0$ 且 仅有
$\theta_5 = \frac{1}{2}$为正数，故$x_3$进基，$x_5$离基，生成新的单纯形表有：

|  c   |        |  $0$  | $-1$  |  $2$  |  $0$   |  $0$  |            |
| :--: | :----: | :---: | :---: | :---: | :----: | :---: | :--------: |
|      | 基变量 | $x_1$ | $x_2$ | $x_3$ | $x_4$  | $x_5$ | 右端项 $b$ |
| $0$  | $x_1$  |  $1$  |  $0$  |  $0$  | $-1/2$ | $5/2$ |   $13/2$   |
| $-1$ | $x_2$  |  $0$  |  $1$  |  $0$  | $-1/2$ | $3/2$ |   $5/2$    |
| $2$  | $x_3$  |  $0$  |  $0$  |  $1$  | $-1/2$ | $1/2$ |   $1/2$    |
|      |  $r$   |  $0$  |  $0$  |  $0$  | $1/2$  | $1/2$ |            |

由于所有校验数$r$都大于$0$，所以此时就是最优解。另因为$B$是单位矩阵，则$x_B = b$,另有$x_N = 0$，故最优解为:

$$
\bar{x} = \begin{bmatrix}13/2 & 5/2 & 1/2 & 0 & 0\end{bmatrix}^T
$$

计算出最优值为:

$$
f(x) = -x_2 + 2x_3 = - \frac{5}{2} + 2 * \frac{1}{2} = -\frac{3}{2}
$$

## 七、 总结

1. 统一转化为最小化问题标准形式
2. 校验数：$r_j = c_j - c_B^T B^{-1} A_j$
3. 若所有 $r_j \ge 0$，则：当前解已经达到最优
4. 进基变量，选择检验数 $r_j < 0$ 的非基变量 $x_j$ 进入基
5. 离基变量，选择比值最小的基变量离开基矩阵（不计负数）$\theta = \frac{b}{A_j}$

> 注意区分矩阵乘法的规则，都是累加，不要和行列式弄混了。
