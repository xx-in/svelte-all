# 最优性条件（Optimality Conditions）

最优性条件是使得最优化问题取得最优值时的充分性和必要性条件，充要条件则是最好的。

根据是否存在约束条件，最优性条件可分为 **无约束最优性条件** 与 **约束最优性条件**。

---

## 一、 无约束优化问题的最优性条件

### 1、 定义

考虑一个连续可微函数：

$$
\min_{x \in \mathbb{R}^n} f(x)
$$

若存在点 $x^*$，使得对于任意的 $x$，都有：

$$
f(x^*) \le f(x),
$$

则称 $x^*$ 为 **最优点（Optimal Point）**，对应的 $f(x^*)$ 为 **最优值（Optimal Value）**。

### 2、充要条件

若 $f(x)$ 在 $x^*$ 处二阶可微：

$$
\nabla f(x^*) = 0, \quad \nabla^2 f(x^*) \succ 0 \Longleftrightarrow f(x^*)\text{为局部最小点}
$$

换句话说，对于二阶可微函数$f(x)$，如果满足以下条件，那么就可以精准计算最优值：

1. 函数是凸函数（海森矩阵是半正定的，用于证明是凸函数）。
2. 梯度为0的点一定是最优点。

---

### 3、 示例

令

$$
f(x_1, x_2) = x_1^2 + 2x_2^2 - 2x_1x_2 - 2x_1
$$

计算梯度与海森矩阵：

$$
\nabla f(x) =
\begin{bmatrix}
2x_1 - 2x_2 - 2 \\
4x_2 - 2x_1
\end{bmatrix}, \quad
\nabla^2 f(x) =
\begin{bmatrix}
2 & -2 \\
-2 & 4
\end{bmatrix}
$$

令梯度为零，得：

$$
2x_1 - 2x_2 - 2 = 0 \\
4x_2 - 2x_1 = 0
$$

解得 $x_1 = 2$, $x_2 = 1$。  
Hessian 的特征值为 $w_1 = 1.17, w_2 = 4.83 > 0$，因此为正定矩阵。  
由二阶充要条件可知，$(2,1)$ 是局部极小点。

---

## 二、 约束优化问题的最优性条件

考虑约束优化问题：

$$
\begin{aligned}
\min_{x \in \mathbb{R}^n} \quad & f(x) \\
\text{s.t.} \quad &
g_i(x) \ge 0, \quad i = 1, \dots, m \\
& h_j(x) = 0, \quad j = 1, \dots, p
\end{aligned}
$$

---

### 1、 定义

若存在可行点 $x^*$ 满足所有约束，且对任意可行点 $x$ 有

$$
f(x^*) \le f(x),
$$

则称 $x^*$ 为 **约束最优解**。

---

### 2、 KKT条件

KKT条件需要满足以下内容：

1. 拉格朗日函数的梯度为0
2. 列出所有原始约束条件
3. 互补松弛条件都等于0
4. 对偶问题决策变量需要满足的条件

> 在$线性约束$的凸规划中，KKT条件成立的点就是全局最优点

> 在包含$非线性约束$条件的规划中，KKT条件成立的点只是候选解

定义 **拉格朗日函数（Lagrangian）**：

$$
\mathcal{L}(x, w, v)
= f(x) - \sum_{i=1}^m w_i g_i(x)
- \sum_{j=1}^p v_j h_j(x)
$$

$$
\begin{cases}
\nabla_x \mathcal{L}(x^*, w^*, v^*) = 0 \quad (\text{拉格朗日梯度})\\
g_i(x^*) \ge 0, \quad (\text{原不等式约束})\\
h_j(x^*) = 0 \quad (\text{原等式约束})\\
w_i^* g_i(x^*) = 0  \quad (\text{互补松弛}) \\
w_i^* \ge 0, \quad (\text{互补松弛的决策变量}) \\
\end{cases}
$$

其中：

- $w_i \ge 0$ 是不等式约束的乘子；
- $v_j$ 是等式约束的乘子。

> 如果不是线性约束条件，$KKT$点只是候选点，是否是最优解需要进一步判断。因为约束条件非线性意味着该规划很可能不是一个凸规划！！

---

### 3、 线性约束凸规划示例

例如：

$$
\begin{aligned}
min \quad f(x) = (x_1-1)^2 + (x_2-1)^2 \\
s.t. \quad -x_1 -x_2 + 2 \ge 0,\\
x_2 - x_1 = 0, \\
x_1 \ge 0, \\
x_2 \ge 0
\end{aligned}
$$

计算拉格朗日函数：

$$
L(x,w,v) = (x_1 - 1)^2 + (x_2 -1)^2 - (-x_1 - x_2 + 2)w_1 - w_2x_1 - x_2w_3 - (-x_2 - x_1 - 1)v
$$

求解拉格朗日函数梯度：

$$
\nabla_x L(x,w,v) = \begin{cases}
2(x_1-1) + w_1 - w_2 +v = 0 \\
2(x_2-1) + w_1 - w_3 -v = 0
\end{cases}
$$

列出全部等式：

$$
\begin{cases}
2(x_1-1) + w_1 - w_2 +v = 0 \\
2(x_2-1) + w_1 - w_3 -v = 0 \\
-x_1 -x_2 + 2 \ge 0,\\
x_2 - x_1 - 1= 0, \\
x_1 \ge 0, \\
x_2 \ge 0, \\
w_1(-x_1 -x_2 + 2) = 0, \\
w_2x_1 = 0, \\
w_3x_2 = 0,\\
w_1 \ge 0,\\
w_2 \ge 0,\\
w_3 \ge 0\\
\end{cases}
$$

求解这个方程组，不妨设$w = 0$，化简有：

$$
\begin{cases}
2(x_1-1) +v = 0 \\
2(x_2-1) -v = 0 \\
-x_1 -x_2 + 2 \ge 0,\\
x_2 - x_1 - 1= 0, \\
\end{cases}
$$

解得

$$
x^* =
\begin{bmatrix}1/2, 3/2\end{bmatrix}, v=1
$$

目标函数是否是最优解，需要先判断目标函数是否是凸函数，判断海森矩阵是否是半正定矩阵：

$$
\nabla^2 f(x) =
\begin{bmatrix}
2&0\\
0&2
\end{bmatrix}
\quad\text{是半正定矩阵}
$$

故满足$KKT$的点就是最优解，带入原式有：

$$
\min{f_x} = f(\frac{1}{2},\frac{3}{2}) = \frac{1}{2}
$$

### 4、 二阶充分条件

$KKT$条件是一阶信息，若一阶信息计算出多个点，则需要通过二阶信息进一步计算：

$$
\nabla^2L_x(\bar{x},\bar{w},\bar{v}) \text{在子空间上是正定的} \Longrightarrow \text{局部最小点}\\
$$

$$
\nabla^2L_x(\bar{x},\bar{w},\bar{v}) \text{在子空间上是负定的} \Longrightarrow \text{局部最大点}
$$

显然这里说的内容还有非常多的残缺，最大的问题出现在线性规划、非线性规划、凸优化、非凸优化问题的混淆上，而要分清楚这些概念则需要更多扩展的知识，
